<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TB-303/TD-3 Helper</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a1a1a">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="loading-content">
            <div class="spinner" aria-hidden="true"></div>
            <div id="loadingMessage">Initialisation...</div>
        </div>
    </div>

    <div class="header">
        <h1>üéµ TB-303/TD-3 HELPER</h1>
        <div class="bpm-control">
            <label for="bpmInput">BPM :</label>
            <input type="number" id="bpmInput" value="120" min="60" max="200" step="1">
        </div>
        <div class="lang-toggle">
            <button id="btnLangFr">üá´üá∑ FrancÃßais</button>
            <button id="btnLangEn">üá¨üáß English</button>
        </div>
        <button class="btn btn-audio hidden" id="initAudio">üîä Appuyez pour initialiser l'audio (iOS Safari)</button>
    </div>

    <!-- Spectre audio -->
    <div class="spectrum-container">
        <canvas id="spectrumCanvas" class="spectrum-canvas"></canvas>
    </div>

    <!-- Panneau de syntheÃÄse 303 -->
    <div class="synthesis-panel">
        <h2>Synthesis Controls</h2>
        <div class="knobs-container">
            <div class="knob-container">
                <div class="knob" id="knobTune" data-min="-12" data-max="12" data-value="0">
                    <div class="knob-indicator"></div>
                </div>
                <div class="knob-label">Tune</div>
                <div class="knob-value" id="valueTune">0</div>
            </div>
            <div class="knob-container">
                <div class="knob" id="knobCutoff" data-min="20" data-max="4000" data-value="800">
                    <div class="knob-indicator"></div>
                </div>
                <div class="knob-label">Cutoff</div>
                <div class="knob-value" id="valueCutoff">800 Hz</div>
            </div>
            <div class="knob-container">
                <div class="knob" id="knobResonance" data-min="0.1" data-max="30" data-value="5">
                    <div class="knob-indicator"></div>
                </div>
                <div class="knob-label">Resonance</div>
                <div class="knob-value" id="valueResonance">5.0</div>
            </div>
            <div class="knob-container">
                <div class="knob" id="knobEnvMod" data-min="0" data-max="100" data-value="50">
                    <div class="knob-indicator"></div>
                </div>
                <div class="knob-label">Env Mod</div>
                <div class="knob-value" id="valueEnvMod">50%</div>
            </div>
            <div class="knob-container">
                <div class="knob" id="knobDecay" data-min="50" data-max="2000" data-value="500">
                    <div class="knob-indicator"></div>
                </div>
                <div class="knob-label">Decay</div>
                <div class="knob-value" id="valueDecay">500 ms</div>
            </div>
            <div class="knob-container">
                <div class="knob" id="knobAccent" data-min="0" data-max="100" data-value="70">
                    <div class="knob-indicator"></div>
                </div>
                <div class="knob-label">Accent</div>
                <div class="knob-value" id="valueAccent">70%</div>
            </div>
            <div class="knob-container">
                <div class="knob" id="knobDrive" data-min="0" data-max="100" data-value="0">
                    <div class="knob-indicator"></div>
                </div>
                <div class="knob-label">Drive</div>
                <div class="knob-value" id="valueDrive">0%</div>
            </div>
            <div class="knob-container">
                <div class="knob" id="knobTone" data-min="20" data-max="20000" data-value="20000">
                    <div class="knob-indicator"></div>
                </div>
                <div class="knob-label">Tone</div>
                <div class="knob-value" id="valueTone">20000 Hz</div>
            </div>
            <div class="knob-container">
                <div class="knob" id="knobDistVolume" data-min="0" data-max="100" data-value="100">
                    <div class="knob-indicator"></div>
                </div>
                <div class="knob-label">Dist Vol</div>
                <div class="knob-value" id="valueDistVolume">100%</div>
            </div>
        </div>
        <div class="waveform-select">
            <label for="waveformSelect">Waveform :</label>
            <select id="waveformSelect">
                <option value="sawtooth">Saw</option>
                <option value="square">Square</option>
            </select>
        </div>
    </div>

    <!-- Pages select for 303 -->
    <div class="pages-control">
        <label for="pages303Select">Pages (303): </label>
        <select id="pages303Select">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
        </select>
    </div>

    <!-- SeÃÅquenceur 303 -->
    <div class="sequencer-container">
        <div id="sequencerGrid" class="sequencer-grid"></div>
    </div>

    <!-- ControÃÇles geÃÅneÃÅraux -->
    <div class="controls-panel">
        <div class="playback-controls">
            <button class="btn btn-play" id="btnPlay">‚ñ∂Ô∏è PLAY</button>
            <button class="btn btn-stop" id="btnStop">‚èπÔ∏è STOP</button>
            <button class="btn btn-clear" id="btnClear">üîÑ CLEAR</button>
            <button class="btn btn-random" id="btnRandom">üé≤ RANDOM</button>
            <button class="btn btn-midi" id="btnMidi">üìÅ EXPORT MIDI</button>
        </div>

        <div class="generate-cta">
            <div class="generate-label">Bouton majeur ‚Äî lance l'assistant complet TD-3</div>
            <button class="btn btn-generate" id="btnGenerate">üöÄ GENERATE TD-3 TUTORIAL</button>
            <div class="generate-subtext">Le moyen le plus rapide et puissant pour d√©marrer : un tutoriel auto-g√©n√©r√©, pr√™t √† suivre.</div>
        </div>

        <div class="secondary-buttons">
            <button class="btn btn-save" id="btnSave">üíæ SAVE (local)</button>
            <button class="btn btn-load" id="btnLoad">üìÇ PATTERNS LIBRARY</button>
            <button class="btn btn-load" id="btnClipboard">üìã LOAD FROM CLIPBOARD</button>
            <button class="btn btn-load" id="btnClipboardSave">üìã SAVE TO CLIPBOARD</button>
            <button class="btn btn-undo" id="btnUndo">‚Ü∂ UNDO</button>
            <button class="btn btn-redo" id="btnRedo">‚Ü∑ REDO</button>
            <button class="btn btn-load" id="btnPatternModal">üß© PATTERNS / TRACK</button>
            <button class="btn btn-faq" id="btnFaq">‚ùì TD-3 FAQ</button>
            <button class="btn btn-preset" id="btnSavePreset">üíæ SAVE 303+DRUM PRESET</button>
            <button class="btn btn-ia" id="btnIa">ü§ñ IA PROMPT GEN</button>
        </div>
    </div>

    <!-- Drum Machine -->
    <div class="drum-909-container" id="drum909Container">
        <div class="drum-909-header">
            <span>Drum Machine Sequencer</span>
            <div class="pages-control">
                <label for="pagesDrumSelect">Pages: </label>
                <select id="pagesDrumSelect">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                </select>
            </div>
            <div class="drum-909-pages">
                <button class="drum-909-page-btn active" data-page="1">Page 1</button>
                <button class="drum-909-page-btn" data-page="2">Page 2</button>
                <button class="drum-909-page-btn" data-page="3">Page 3</button>
                <button class="drum-909-page-btn" data-page="4">Page 4</button>
            </div>
        </div>
        <div class="drum-909-grid">
            <div class="drum-909-grid-inner" id="drum909GridInner">
                <!-- JS remplira ici la grille d‚Äôinstruments / steps. -->
            </div>
        </div>
        <div class="drum-909-mixer" id="drum909Mixer">
            <!-- JS remplira les faders volume par instrument. -->
        </div>
    </div>

    <!-- Overlay & Toast -->
    <div class="overlay" id="overlay">
        <div class="spinner"></div>
    </div>
    <div class="toast" id="toast"></div>

    <!-- Modal Tutoriel TD-3 -->
    <div class="modal" id="tutorialModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>TD-3 Programming Tutorial</h2>
                <span class="modal-close" id="modalClose">&times;</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div id="tutorialContent"></div>
        </div>
    </div>

    <!-- Modal Patterns / Track -->
    <div class="modal" id="patternModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Pattern Library & Track Mode</h2>
                <span class="modal-close" id="patternModalClose">&times;</span>
            </div>
            <div class="pattern-layout">
                <div class="pattern-list">
                    <h3>Saved Patterns (localStorage)</h3>
                    <ul id="patternList"></ul>
                </div>
                <div class="track-config">
                    <h3>Track Chain (16-step patterns)</h3>
                    <div class="track-length-row">
                        <label for="trackLengthInput">Length :</label>
                        <input type="number" id="trackLengthInput" min="1" max="64" value="4">
                        <button class="btn btn-load" id="btnApplyTrackLength">Apply</button>
                    </div>
                    <div id="trackChainContainer"></div>
                    <div class="track-controls">
                        <button class="btn btn-play" id="btnTrackPlay">‚ñ∂Ô∏è PLAY TRACK</button>
                        <button class="btn btn-stop" id="btnTrackStop">‚èπÔ∏è STOP TRACK</button>
                        <button class="btn btn-generate" id="btnTrackTutorial">üìò TRACK TUTORIAL</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal FAQ TD-3 -->
    <div class="modal" id="faqModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>TD-3 FAQ (under construction)</h2>
                <span class="modal-close" id="faqModalClose">&times;</span>
            </div>
            <div class="faq-content" id="faqContent"></div>
        </div>
    </div>

    <!-- Modal Prompt Welcome -->
    <div class="modal" id="promptWelcomeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Welcome to IA Prompt Generator</h2>
                <span class="modal-close" id="promptWelcomeClose">&times;</span>
            </div>
            <div id="promptWelcomeContent">
                <p>This feature generates an optimized mega-prompt for an LLM (like Grok or ChatGPT) to compose TB-303/Drum Machine patterns. Click 'OK' to start.</p>
                <label><input type="checkbox" id="dontShowAgain"> Don't show again</label>
                <button id="promptOkBtn" class="btn btn-play">OK</button>
            </div>
        </div>
    </div>

    <!-- Modal Prompt Main -->
    <div class="modal" id="promptModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>IA Prompt Generator</h2>
                <span class="modal-close" id="promptModalClose">&times;</span>
            </div>
            <div class="prompt-form">
                <label for="promptTempo">Tempo (BPM):</label>
                <input type="number" id="promptTempo" value="120" min="60" max="200">

                <label for="promptFundamental">Fundamental Note:</label>
                <select id="promptFundamental">
                    <!-- JS popule with noteNamesAsc -->
                </select>

                <label for="promptStyle1">Main Style:</label>
                <select id="promptStyle1">
                    <!-- JS popule with styles -->
                </select>

                <label for="promptStyle2">Additional Style (optional):</label>
                <select id="promptStyle2">
                    <option value="">None</option>
                    <!-- JS popule -->
                </select>

                <label for="promptAtmosphere">Atmosphere:</label>
                <select id="promptAtmosphere">
                    <!-- JS popule with atmospheres -->
                </select>

                <label for="promptScale">Scale/Mode:</label>
                <select id="promptScale">
                    <!-- JS popule with scales -->
                </select>

                <label for="promptRhythmSig">Rhythmic Signature:</label>
                <select id="promptRhythmSig">
                    <!-- JS popule with rhythmSigs -->
                </select>

                <label for="promptNumPatterns">Number of Patterns (1-8):</label>
                <input type="number" id="promptNumPatterns" min="1" max="8" value="1">

                <div class="prompt-type">
                    <label><input type="radio" name="promptType" value="303" id="promptType303"> 303 Only</label>
                    <label><input type="radio" name="promptType" value="drum" id="promptTypeDrum"> Drums Only</label>
                    <label><input type="radio" name="promptType" value="both" id="promptTypeBoth" checked> 303 + Drums</label>
                </div>

                <label for="promptAdjectives">Additional Adjectives:</label>
                <textarea id="promptAdjectives" rows="3"></textarea>

                <button class="btn btn-generate" id="generatePromptBtn">Generate Prompt</button>

                <label for="promptOutput">Generated Prompt:</label>
                <textarea id="promptOutput" rows="10" readonly></textarea>

                <button class="btn btn-save" id="copyPromptBtn">Copy Prompt</button>

                <p id="promptExpl"></p>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>